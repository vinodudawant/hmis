var pageName=$("#pageName").val();


tinymce.PluginManager.add("preview",function(e){var t=e.settings;e.addCommand("mcePreview",function(){
	
	
	e.windowManager.open({title:"Preview",width:parseInt(e.getParam("plugin_preview_width","650"),10),height:parseInt(e.getParam("plugin_preview_height","500"),10),html:'<iframe src="javascript:\'\'" frameborder="0"></iframe>',buttons:{text:"Close",onclick:function(){this.parent().parent().close()}},onPostRender:function()
		{
		var i,n=this.getEl("body").firstChild.contentWindow.document,a="";tinymce.each(e.contentCSS,function(t){
			
		

				var head ="";  
				if(pageName=="IPD_Discharge") {      
					var hospDetails = $("#hospDetails").html();
					hospDetails = eval('(' + hospDetails + ')');
					var hosp = hospDetails.listHosDetail[0];

					var rby = "";
					if ($("#refBy").val() == "undefined") {
						rby = "";
					} else {
						rby = $("#refBy").val();
					}
					

					var IPDDischarge='<html><body><div style="width:25%;float:left;"><img src="'+ hosp.flpt+ '" width="200" height="150" alt="" /></div><div style="text-align: center;" id="SRBill"><h1>'+ hosp.hn + '</h1>	<b>' + hosp.ha + '-' + hosp.hz
									+ '</b><br></br> <b>Tel:-' + hosp.hcon + '.</b><b>Fax:-'
									+ hosp.hx + '.</b></div></div>_______________________________________________________________________________________________<strong><h2>Discharge Summary</h2></strong><table cellpadding="0" cellspacing="0" style="border: solid 1px;" width="100%"><tr height="35px"><td  style="width: 20%;border: solid 1px;padding-left: 10px;font-weight:bold;" align="left">Name of the Patient</td>'
									+'<td style="border: solid 1px;padding-left: 10px;" align="left" >'
									+ $("#patName").val()+' </td><td  width="20%" style="border: solid 1px;padding-left: 10px;font-weight:bold;" align="left">Reg. No.</td><td style="border: solid 1px;padding-left: 10px;" align="left" >'
									+ $("#regNo").val() + ' </td></tr><tr height="35px"><td  style="border: solid 1px;padding-left: 10px;font-weight:bold;" align="left">Age</td><td style="border: solid 1px;padding-left: 10px;" align="left" >'
									+ $("#age").val()+ ' </td><td  style="border: solid 1px;padding-left: 10px;font-weight:bold;" align="left">Sex</td><td style="border: solid 1px;padding-left: 10px;" align="left" >'
									+ $("#sex").val() + ' </td></tr><tr height="35px"><td  style="border: solid 1px;padding-left: 10px;font-weight:bold;" align="left">Date of Admission</td><td style="border: solid 1px;padding-left: 10px;" align="left" >'
									+ $("#admitDate").val()+ ' </td><td  style="border: solid 1px;padding-left: 10px;font-weight:bold;" align="left">Date of Discharge</td><td style="border: solid 1px;padding-left: 10px;" align="left" >&nbsp;'
									+ $("#dischargeDate").val() + ' </td></tr><tr height="35px"><td  style="border: solid 1px;padding-left: 10px;font-weight:bold;" align="left">Incharge Dr./unit</td><td style="border: solid 1px;padding-left: 10px;" align="left" >'
									+ $("#inchargeDr").val()+ ' </td><td  style="border: solid 1px;padding-left: 10px;font-weight:bold;" align="left">Ref By:</td><td style="border: solid 1px;padding-left: 10px;" align="left" >'
									+ rby + '</td></tr></table><table cellpadding="0" cellspacing="0" style=" padding-top: 20px;" width="100%"><tr><td colspan="3" style="border: solid 1px;" align="left" ><div style="width: 98%;padding: 1%;">'+e.getContent()+'</div> </td></tr></table><div style="width: 100%;padding-top:80px;"><div style="width: 20%;float:right;">Doctor Sign</div></div>';
					
						
						head = head+IPDDischarge;
					}
				else
					{
					head=e.getContent();
					}
					
					
			
				a=head+a;
				
	a+='<link type="text/css" rel="stylesheet" href="'+e.documentBaseURI.toAbsolute(t)+'">'});
var d=t.body_id||"tinymce";-1!=d.indexOf("=")&&(d=e.getParam("body_id","","hash"),d=d[e.id]||d);var r=t.body_class||"";-1!=r.indexOf("=")&&(r=e.getParam("body_class","","hash"),r=r[e.id]||""),i="<!DOCTYPE html><html><head>"+a+"</head>"+'<body id="'+d+'" class="mce-content-body '+r+'"> '   ;"'</body>"+"</html>",n.open(),n.write(i),n.close()}})}),e.addButton("preview",{title:"Preview",cmd:"mcePreview"}),e.addMenuItem("preview",{text:+"Preview",cmd:"mcePreview",context:"view"})});


